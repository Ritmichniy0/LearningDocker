# ADD

```
    ADD [OPTIONS] <src> ... <dest>
    ADD [OPTIONS] ["<src>", ... "<dest>"]
```

__Таблица 1__
| Options        | Описание                                                                                                                              | Минимальная версия докера |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
| --keep-git-dir | Сохраняет .git директорию при копировании репозитория                                                                                 | 1.1                       |
| --checksum     | Проверяет контрольную сумму загружаемого архива, чтобы избежать дублирования                                                          | 1.6                       |
| --chown        | Задает владельца файлов и директорий в контейнере                                                                                     | 1.3                       |
| --chmod        | Устанавливает права доступа к файлам                                                                                                  | 1.2                       |
| --link         | Использует жёсткие ссылки для копирования, что позволяет повторно использовать слои из кэша, уменьшая размер образа и ускоряя сборку  | 1.4                       |
| --exclude      | Исключает определенные файлы или директории при копировании                                                                           | 1.7-labs                  |

__Расширение для таблицы 1__

### 1. --keep-git-dir
- **Описание**: Сохраняет `.git` директорию при копировании репозитория.

- **Команда**
```
    ADD <src.git> <dest>
    ADD --keep-git-dir=true <src.git> <dest>
```
- **Пример использования**
```
    ADD git@github.com:Ritmichniy0/django.git#stable/0.90.x:docs
    ADD --keep-git-dir=true git@github.com:Ritmichniy0/django.git#stable/0.90.x:docs
```

Разберем более детально что тут происходит
1. Указания пути к github через SSH
2.  #- показывает что надо выбрать ветку и директорию(можно и без него, по умолчанию заберет master/main)
4. (stable/0.90) указали ветку, обязательно при '#'
5. (docs) указали директорию которую будем забирать в контейнер(не обязательно указывать, если нужен весь git)

Важно если keep-git-dir сохраняет всю историю, то без него только данный коммит
### 2. --checksum
- **Описание**: Проверяет контрольную сумму загружаемого архива, чтобы избежать дублирования.

- **Команда**
```
ADD [--checksum=<hash>] <src(network)> ... <dest>
```

- **Пример использования**
```
ADD --checksum=sha256:24454f830cdb571e2c4ad15481119c43b3cafd48dd869a9b2945d1036d1dc68d https://mirrors.edge.kernel.org/pub/linux/kernel/Historic/linux-0.01.tar.gz /
```

пример взят из интернет ресурса [docs.docker](https://docs.docker.com/reference/dockerfile/#add---checksum)

Примечание

1. Если файл изменился на сервере, но его URL тот же, Docker не загрузит его заново без изменения
3. Поддерживает __только__ http/https

## Схожие методы с COPY

### 3. --chown и chmod

- **Описание**: Устанавливает права доступа к файлам. Задает владельца файлов и директорий в контейнере

- **Пример использования**
```
COPY [--chown=<user>:<group>] [--chmod=<perms> ...] <src> ... <dest>
```

__Права доступа(chmod)__ 
| Код | Описание                                                                       |
|-----|--------------------------------------------------------------------------------|
| 744 | разрешить все для владельца, а остальным только чтение                         |
| 755 | все для владельца, остальным только чтение и выполнение                        |
| 764 | все для владельца, чтение и запись для группы, и только чтение для   остальных |
| 777 | всем разрешено все                                                             |

### 4.--link
- **Описание**: Сохраняет слои и файлы в кэш для последующих сборок.

- **Команда**
```
COPY --link <src> <dest> 
```
- **Пример использования**
```
# Этап 1: сборка
FROM golang:1.20 AS builder # 1.Образ
WORKDIR /app #Указываем рабочую директорию
COPY --link . .  #Копируем файлы из лок. в контейнер
RUN go build -o myapp #Запускаем билд Golang

# Этап 2: финальный образ
FROM alpine:latest # 2.Образ
WORKDIR /app # Указываем рабочую директорию
COPY --from=builder --link /app/myapp . # Копируем из образа 1 во 2, если же он не изменился, то пропускает
CMD ["./myapp"] # Запускает myapp
```

Команда для сохранения слои и файлы в кэш при следующем build он проверит не изменились ли они, если да то делает опирацию которую вы задали, если нет, то пропускает
Для полноты использования команда работает от 2-х и более образов, показано в примере использования

Примечание
1. Нет смысла, если у вас не многообразная сборка.
2. --link позволяет избежать повторного копирования файлов, если они не изменились. Это не уменьшает количество слоёв, но ускоряет сборку при многократном использовании.

### 5.--exclude
- **Описание**: Исключает определенные файлы или директории при копировании.

- **Команда**
```
COPY [--exclude=<path> ...] <src> ... <dest>
```

- **Пример использования**:
```
ADD --exclude=*.tmp /src/ /dest/
```

## Другие операции схожи с COPY

1. Добавление файлов с расширением .cs
```
    ADD *.cs /Files/
```
2. Добавление файла у которого расширение отличается
```
    ADD index.?s /dest/
```
?-заменяет ровно один символ (например, index.js, index.ts, но не index.vue)

3. Если же в имени файла есть '[' то экранировать это нужно при помощи
```
ADD arr[[]0].* /dest/
```
Добавит все файлы arr[0].(с любым расширением)

## Примечание если можно использовать COPY вместо ADD, то используйте COPY

✅ Используй COPY, если...
1. Просто копировать файлы из локальной директории в контейнер
2. Нужна максимальная предсказуемость (без неожиданной распаковки)
3. Избежать лишнего кеширования в Docker

✅ Используй ADD, если...
1. Нужно скачать файл по http/https (без curl) + git
2. Копировать .tar.gz и хочешь, чтобы он автоматически распаковался
